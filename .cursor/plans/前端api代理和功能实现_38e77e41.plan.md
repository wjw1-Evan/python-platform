---
name: 前端API代理和功能实现
overview: 配置前端API代理指向后端API网关，实现登录注册、用户管理、企业管理、通知和日志等完整功能模块，并更新开发规范文件。
todos:
  - id: proxy-config
    content: 配置前端API代理：更新 proxy.ts 和 app.tsx 中的请求配置，添加JWT Token拦截器
    status: completed
  - id: api-services
    content: 创建统一API服务层：实现 authAPI、userAPI、companyAPI、notificationAPI、logAPI
    status: completed
  - id: login-register
    content: 实现登录注册：更新登录页面调用后端API，创建注册页面
    status: completed
  - id: user-management
    content: 实现用户管理：创建用户列表页面，支持CRUD操作
    status: completed
  - id: company-management
    content: 实现企业管理：创建企业列表页面，支持查看、编辑、加入/退出
    status: completed
  - id: notification
    content: 实现通知功能：创建WebSocket工具类、通知页面和头部通知组件
    status: completed
  - id: log
    content: 实现日志功能：创建日志查看页面，支持筛选和统计
    status: completed
  - id: routes-i18n
    content: 更新路由和国际化：添加新路由配置和菜单翻译
    status: completed
  - id: cursorrules
    content: 创建/更新 .cursorrules 文件：添加前端开发规范
    status: completed
---

# 前端API代理配置和功能实现计划

## 1. 配置API代理

### 1.1 更新代理配置 (`frontend/config/proxy.ts`)

- 配置开发环境代理，将 `/api/` 请求代理到 `http://localhost:8000`
- 配置 `changeOrigin: true` 和正确的路径重写规则

### 1.2 更新请求配置 (`frontend/src/app.tsx`)

- 修改 `request.baseURL` 为 `/api`（使用代理）
- 配置请求拦截器，自动添加 JWT Token 到请求头
- 配置响应拦截器，处理 401 错误自动跳转登录页
- 配置错误处理逻辑

## 2. 创建API服务层

### 2.1 创建统一API服务 (`frontend/src/services/api.ts`)

基于 `API_INTEGRATION.md` 创建完整的API服务：

- `authAPI`: 登录、注册、刷新Token
- `userAPI`: 用户列表、详情、更新、删除
- `companyAPI`: 企业列表、详情、更新、加入、退出
- `notificationAPI`: 通知列表、未读数量、标记已读
- `logAPI`: 日志列表、统计信息

### 2.2 更新类型定义 (`frontend/src/services/ant-design-pro/typings.d.ts`)

添加后端API响应的TypeScript类型定义

## 3. 实现登录注册功能

### 3.1 更新登录页面 (`frontend/src/pages/user/login/index.tsx`)

- 修改登录逻辑，调用后端 `/api/auth/login/` 接口
- 保存 access token 和 refresh token 到 localStorage
- 处理登录成功后的用户信息获取和状态更新
- 支持企业选择（如果用户属于多个企业）

### 3.2 创建注册页面 (`frontend/src/pages/user/register/index.tsx`)

- 创建注册表单（用户名、邮箱、密码、企业名称）
- 调用 `/api/auth/register/` 接口
- 注册成功后跳转到登录页或直接登录

## 4. 实现用户管理功能

### 4.1 创建用户管理页面 (`frontend/src/pages/user/list/index.tsx`)

- 使用 ProTable 组件展示用户列表
- 支持分页、搜索、筛选
- 实现用户详情查看、编辑、删除功能
- 调用 `userAPI` 相关接口

## 5. 实现企业管理功能

### 5.1 创建企业管理页面 (`frontend/src/pages/company/list/index.tsx`)

- 使用 ProTable 展示企业列表
- 支持企业详情查看、编辑
- 实现用户加入/退出企业功能
- 调用 `companyAPI` 相关接口

## 6. 实现通知功能

### 6.1 创建通知工具类 (`frontend/src/utils/websocket.ts`)

- 实现 WebSocket 连接管理
- 支持自动重连机制
- 处理通知消息接收和分发

### 6.2 创建通知页面 (`frontend/src/pages/notification/index.tsx`)

- 展示通知列表（未读/已读）
- 支持标记单个/全部已读
- 显示未读通知数量
- 集成 WebSocket 实时接收通知

### 6.3 更新通知组件 (`frontend/src/components/RightContent/index.tsx`)

- 在头部显示未读通知数量
- 点击显示通知下拉列表
- 实时更新通知状态

## 7. 实现日志功能

### 7.1 创建日志页面 (`frontend/src/pages/log/index.tsx`)

- 使用 ProTable 展示日志列表
- 支持按日志类型、级别、时间范围筛选
- 显示日志统计信息（图表）
- 调用 `logAPI` 相关接口

## 8. 更新路由配置

### 8.1 更新路由 (`frontend/config/routes.ts`)

添加以下路由：

- `/user/register` - 注册页面
- `/user/list` - 用户管理
- `/company/list` - 企业管理
- `/notification` - 通知中心
- `/log` - 日志查看

### 8.2 更新菜单国际化 (`frontend/src/locales/zh-CN/menu.ts`)

添加新菜单项的中文翻译

## 9. 更新开发规范

### 9.1 创建/更新 `.cursorrules` 文件

添加以下规范：

- 前端代码规范（TypeScript、React、Ant Design Pro）
- API调用规范（统一使用 services/api.ts）
- 组件开发规范
- 路由配置规范
- 国际化规范
- 错误处理规范

## 10. 环境变量配置

### 10.1 创建环境变量文件 (`.env.development`)

- `REACT_APP_API_BASE_URL=http://localhost:8000`
- `REACT_APP_WS_URL=ws://localhost:8005`

## 技术要点

1. **Token管理**: 使用 localStorage 存储 access token，请求时自动添加到 Authorization 头
2. **错误处理**: 统一处理 401/403/500 等错误，401 自动跳转登录
3. **WebSocket**: 在用户登录后建立连接，登出时断开
4. **数据格式**: 后端返回格式为 `{items: [], total: number, page: number, page_size: number}`
5. **权限控制**: 基于 initialState 的 currentUser 进行权限判断

## 文件清单

### 需要创建的文件

- `frontend/src/services/api.ts` - API服务层
- `frontend/src/pages/user/register/index.tsx` - 注册页面
- `frontend/src/pages/user/list/index.tsx` - 用户管理
- `frontend/src/pages/company/list/index.tsx` - 企业管理
- `frontend/src/pages/notification/index.tsx` - 通知页面
- `frontend/src/pages/log/index.tsx` - 日志页面
- `frontend/src/utils/websocket.ts` - WebSocket工具
- `.cursorrules` - 开发规范文件
- `.env.development` - 环境变量配置

### 需要修改的文件

- `frontend/config/proxy.ts` - 代理配置
- `frontend/src/app.tsx` - 请求配置
- `frontend/src/pages/user/login/index.tsx` - 登录页面
- `frontend/config/routes.ts` - 路由配置
- `frontend/src/locales/zh-CN/menu.ts` - 菜单国际化
- `frontend/src/components/RightContent/index.tsx` - 通知组件